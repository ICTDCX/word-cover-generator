<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tạo Bìa Word - Phiên Bản Cuối</title>
    <!-- Thư viện tạo PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .main-content {
            display: grid;
            grid-template-columns: minmax(560px, 1fr) 380px;
            gap: 18px;
            padding: 20px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .template-section {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            position: sticky;
            top: 16px;
            align-self: start;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .preview-section {
            grid-column: 1 / -1;
            background: white;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            margin-top: 12px;
        }

        .preview-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .preview-html, .preview-image {
            display: flex;
            flex-direction: column;
        }

        .preview-html h4, .preview-image h4 {
            margin-bottom: 10px;
            color: #495057;
            font-size: 14px;
        }

        #coverImage {
            width: 100%;
            height: 400px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            overflow: hidden;
            position: relative;
        }

        .preview-image .placeholder {
            color: #999;
            text-align: center;
            font-style: italic;
        }



        .cover-preview {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px;
            background: white;
            width: 21cm;
            height: 29.7cm;
            margin: 0 auto;
            box-sizing: border-box;
            position: relative;
            transform: scale(0.64);
            transform-origin: top center;
            font-family: 'Times New Roman', serif;
            font-size: 14pt;
            line-height: 1.25;
            color: #000;
            overflow: hidden;
        }

        .cover-content {
            padding: 1.1cm;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-sizing: border-box;
            position: relative;
            overflow: visible;
            z-index: 1;
        }

        /* Inner frame to reduce emptiness */
        .content-frame {
            border: none;
            border-radius: 0;
            padding: 0;
            background: #fff;
            max-width: 17.5cm;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 0;
            position: relative;
        }

        .header-section {
            text-align: center;
            margin-bottom: 0.8cm;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }

        .university-name {
            font-size: 16pt;
            font-weight: bold;
            margin-bottom: 0.4cm;
            text-transform: uppercase;
            line-height: 1.2;
        }

        .logo-placeholder {
            width: 6.75cm; /* tăng 1.5 lần */
            height: 6.75cm; /* tăng 1.5 lần */
            border: 2pt solid #000;
            border-radius: 50%;
            margin: 0.4cm auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14pt;
        }

        .logo-placeholder img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 50%;
            width: 100%;
            height: 100%;
        }

        .subject-name {
            font-size: 14pt;
            font-weight: bold;
            margin-top: 0.4cm;
            text-transform: uppercase;
            line-height: 1.2;
        }

        .header-accent { height: 4pt; width: 8cm; margin: 0.4cm auto 0; border-radius: 3pt; background: #000; }
        .accent-1 { background:#1a237e; }
        .accent-2 { background:linear-gradient(90deg, #667eea, #764ba2); }
        .accent-3 { background:#b68e2e; }
        .accent-4 { background:#2e7d32; }
        .accent-5 { background:#9e9e9e; }
        .accent-6 { background:#26a69a; }
        .accent-7 { background:#424242; }
        .accent-8 { background:#616161; }
        .accent-9 { background:#1e3a8a; }


        .topic-section {
            margin: 0.6cm 0;
            padding: 0.9cm;
            border-left: 4pt solid #000;
            background: #f8f9fa;
            flex: 0 0 auto;
            display: block;
            min-height: 0;
            position: relative;
            z-index: 1;
            overflow-wrap: anywhere;
            word-break: break-word;
        }

        /* Topic box variants mapped to border templates */
        .topic-variant-1 { border-left: 4pt solid rgba(26,35,126,0.6); background: rgba(248,249,250,0.8); }
        .topic-variant-2 { border-left: 0; background: linear-gradient(135deg, rgba(102,126,234,0.08), rgba(118,75,162,0.08)); border: 2pt solid rgba(102,126,234,0.5); padding: 0.8cm; border-radius: 10pt; }
        .topic-variant-3 { border-left: 0; background: #ffffff; border: 1.5pt solid rgba(182,142,46,0.3); border-radius: 10pt; padding: 0.6cm 0.8cm; box-shadow: 0 2px 8px rgba(182,142,46,0.12); }
        .topic-variant-4 { 
            border-left: 0;
            background: #ffffff;
            border: 1.5pt solid rgba(46,125,50,0.35);
            border-radius: 12pt;
            box-shadow: 0 2px 8px rgba(46,125,50,0.12);
            position: relative;
            padding: 0.6cm 0.8cm 0.8cm 0.8cm;
        }
        .topic-variant-4::before {
            content: "";
            position: absolute;
            top: 0.6cm; left: 0.8cm; right: 0.8cm; height: 6pt;
            border-radius: 4pt;
            background: linear-gradient(90deg, rgba(46,125,50,0.25), rgba(76,175,80,0.25));
        }
        .topic-variant-5 { border-left: 0; background: linear-gradient(135deg, rgba(245,245,245,0.8), rgba(224,224,224,0.8)); border: 2pt solid rgba(158,158,158,0.55); padding: 0.8cm; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .topic-variant-6 { border-left: 0; background: linear-gradient(135deg, rgba(224,242,241,0.8), rgba(200,230,223,0.8)); border: 2pt solid rgba(38,166,154,0.55); border-radius: 12pt; }
        .topic-variant-7 { 
            border-left: 0;
            background: linear-gradient(135deg, rgba(66,66,66,0.06), rgba(97,97,97,0.06));
            border: 2pt solid rgba(66,66,66,0.4);
            border-radius: 15pt;
            position: relative;
            padding: 0.8cm 1cm;
            box-shadow: 0 4px 15px rgba(66,66,66,0.15);
        }
        .topic-variant-7::before {
            content: "";
            position: absolute;
            top: 0.5cm; left: 0.8cm; right: 0.8cm; height: 3pt;
            border-radius: 2pt;
            background: linear-gradient(90deg, rgba(66,66,66,0.3), rgba(97,97,97,0.3));
        }
        .topic-variant-8 { 
            border-left: 0;
            background: linear-gradient(135deg, rgba(97,97,97,0.08), rgba(117,117,117,0.08));
            border: 2.5pt solid transparent;
            border-radius: 18pt;
            position: relative;
            padding: 0.9cm 1.1cm;
            background-clip: padding-box;
        }
        .topic-variant-8::before {
            content: "";
            position: absolute;
            inset: -2.5pt;
            border-radius: 18pt;
            background: linear-gradient(45deg, rgba(66,66,66,0.6), rgba(97,97,97,0.6), rgba(117,117,117,0.6));
            z-index: -1;
        }
        .topic-variant-9 { 
            border-left: 0;
            background: linear-gradient(135deg, rgba(30,58,138,0.08), rgba(59,130,246,0.08));
            border: 2.5pt solid transparent;
            border-radius: 16pt;
            position: relative;
            padding: 1cm 1.2cm;
            background-clip: padding-box;
            box-shadow: 0 6px 20px rgba(30,58,138,0.15);
        }
        .topic-variant-9::before {
            content: "";
            position: absolute;
            inset: -2.5pt;
            border-radius: 16pt;
            background: linear-gradient(45deg, rgba(30,58,138,0.6), rgba(59,130,246,0.6), rgba(147,197,253,0.6));
            z-index: -1;
        }
        .topic-variant-9::after {
            content: "";
            position: absolute;
            top: 0.8cm; left: 1.2cm; right: 1.2cm; height: 3pt;
            border-radius: 2pt;
            background: linear-gradient(90deg, rgba(30,58,138,0.4), rgba(59,130,246,0.4));
        }


        .topic-title {
            font-weight: bold;
            margin-bottom: 0.2cm;
            font-size: 13pt;
            text-transform: uppercase;
        }

        .topic-content {
            font-size: 13pt;
            line-height: 1.5;
            white-space: normal;
        }

        .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.7cm;
            margin: 0.6cm auto;
            max-width: 16cm;
            flex-shrink: 0;
            min-height: 0;
        }

        /* Template 1: Tinh tế - Bố cục hai cột thanh lịch */
        .template-1 .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.6cm; /* hàng gần nhau hơn */
            margin: -0.4cm auto 0;
            max-width: 16cm;
            align-items: start;
        }
        .template-1 .info-item {
            margin-bottom: 0; /* loại bỏ khoảng cách thừa giữa hàng */
            padding: 0.5cm;
            background: linear-gradient(135deg, rgba(26,35,126,0.06), rgba(26,35,126,0.02));
            border-left: 3pt solid rgba(26,35,126,0.6);
            border-radius: 0 8pt 8pt 0;
            position: relative;
            box-shadow: 0 3px 10px rgba(26,35,126,0.10);
        }
        .template-1 .info-item::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: 0 8pt 8pt 0;
            background: linear-gradient(135deg, rgba(102,126,234,0.10), transparent 65%);
            pointer-events: none;
        }
        /* Giảm khoảng trắng sau khối đề tài và kéo cụm box lại gần hơn */
        .cover-preview.template-1 .topic-section {
            margin: -1.9cm 0 0.5cm; /* nâng thêm 1cm nữa */
            padding: 1cm;
        }
        .template-1 .info-label {
            font-weight: bold;
            color: #1a237e;
            display: block;
            margin-bottom: 0.2cm;
            font-size: 12pt;
        }
        .template-1 .info-value {
            color: #333;
            font-size: 13pt;
        }

        /* Template 2: Hiện đại - Bố cục gradient card */
        .template-2 .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1cm;
            margin: 0.2cm auto; /* nâng lên ~1cm */
            max-width: 16cm;
        }
        .template-2 .info-item {
            margin-bottom: 0.5cm;
            padding: 0.6cm;
            background: linear-gradient(135deg, rgba(102,126,234,0.24), rgba(118,75,162,0.24));
            color: #1f2937; /* chữ đậm, dễ đọc trên nền nhạt */
            border-radius: 8pt;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.12);
            border: 1pt solid rgba(102,126,234,0.35);
        }
        .template-2 .info-label {
            font-weight: bold;
            display: block;
            margin-bottom: 0.15cm;
            font-size: 11pt;
            color: #3f51b5; /* indigo dịu mắt */
            opacity: 0.9;
            white-space: normal; /* bảo toàn tiêu đề đầy đủ */
            overflow: visible;
            text-overflow: initial;
        }
        .template-2 .info-value {
            font-size: 13pt;
            font-weight: 500;
            color: #1f2937;
        }

        /* Harmonize topic + panel for template-2 (avoid white blocks) */
        .cover-preview.template-2 .topic-variant-2 {
            background: linear-gradient(135deg, rgba(102,126,234,0.08), rgba(118,75,162,0.08));
            border: 2pt solid rgba(102,126,234,0.5);
            border-radius: 10pt;
            padding: 0.8cm;
        }
        .cover-preview.template-2 .info-panel {
            background: transparent;
            border: none;
            box-shadow: none;
            padding: 0.2cm 0.2cm 0.2cm 0.2cm;
        }

        /* Template 3: Cổ điển - Bố cục 1 cột 3 dấu : */
        .template-3 .info-section {
            margin: -0.4cm auto; /* nâng lên thêm ~1cm */
            max-width: 18cm; /* mở rộng vùng chứa để hạn chế xuống dòng */
            display: block;
            background: transparent;
            border: none;
            padding: 0;
        }
        .template-3 .info-item {
            display: grid; /* 2 cột: nhãn | nội dung */
            grid-template-columns: 44% 1fr;
            align-items: start;
            column-gap: 10pt;
            margin: 8pt 0;
            padding: 8pt 14pt;
            background: #ffffff;
            border: 1px solid rgba(182, 142, 46, 0.3);
            border-radius: 10pt;
            box-shadow: 0 2px 8px rgba(182, 142, 46, 0.12);
        }
        .template-3 .info-item::before { content: none; }
        .template-3 .info-item:last-child {
            border-bottom: none;
        }
        .template-3 .info-label {
            font-weight: 600;
            color: #b68e2e;
            font-size: 12pt;
            width: 100%;
            margin-right: 0;
            position: relative;
            padding-right: 0;
            white-space: normal; /* cho phép xuống dòng theo nội dung */
            overflow: visible;
            text-overflow: initial;
            line-height: 1.4;
            text-align: left;
        }
        .template-3 .info-label::after { content: none; }
        .template-3 .info-value {
            color: #333;
            font-size: 13pt;
            flex: 1;
            white-space: normal; /* tự xuống dòng khi dài */
            overflow: visible;
            text-overflow: initial;
            word-break: break-word;
            hyphens: auto;
            line-height: 1.4;
            position: relative;
            padding-left: 0;
        }
        .template-3 .info-value::before { content: ""; }

        /* Template 4: Á Đông - Bố cục 1 cột 3 dấu : */
        .template-4 .info-section {
            margin: -1.5cm auto; /* nâng lên thêm ~1cm nữa */
            max-width: 18cm;
            background: transparent;
            border: none;
            border-radius: 10pt;
            padding: 0.3cm 0; /* bảng gọn gàng */
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2 cột độ rộng bằng nhau */
            grid-template-rows: auto auto; /* đúng 2 hàng */
            column-gap: 16pt;
            row-gap: 12pt;
            justify-items: stretch;
        }
        .template-4 .info-item {
            display: flex;
            align-items: center;
            gap: 10pt;
            background: #ffffff;
            border: 1px solid rgba(46,125,50,0.25);
            border-radius: 10pt;
            box-shadow: 0 2px 8px rgba(46,125,50,0.12);
            padding: 10pt 16pt;
        }
        /* Bố trí 2 hàng 2 cột: [1]SV - [2]MSV ; [4]GV - [3]Lớp */
        .template-4 .info-section .info-item:nth-child(1) { grid-column: 1; grid-row: 1; }
        .template-4 .info-section .info-item:nth-child(2) { grid-column: 2; grid-row: 1; }
        .template-4 .info-section .info-item:nth-child(3) { grid-column: 2; grid-row: 2; }
        .template-4 .info-section .info-item:nth-child(4) { grid-column: 1; grid-row: 2; }
        .template-4 .info-item:last-child {
            border-bottom: none;
        }
        .template-4 .info-item::before { content: none; }
        .template-4 .info-label {
            font-weight: 700;
            color: #2e7d32;
            font-size: 12pt;
            position: relative;
            padding-right: 8pt;
            white-space: nowrap;
        }
        .template-4 .info-label::after { content: ":"; position: absolute; right: 0; top: 0; }
        .template-4 .info-value {
            color: #333;
            font-size: 13pt;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Template 5: Sang trọng - Bố cục 1 cột 3 dấu : */
        .template-5 .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr; /* như mẫu 1 */
            gap: 1.5cm;
            margin: 0.8cm auto; /* nâng cụm box lên cao hơn */
            max-width: 16cm;
        }
        .template-5 .info-item {
            margin-bottom: 0.6cm;
            padding: 0.5cm;
            background: linear-gradient(135deg, rgba(158,158,158,0.08), rgba(158,158,158,0.03));
            border-left: 3pt solid rgba(158,158,158,0.6);
            border-radius: 0 6pt 6pt 0;
        }
        .template-5 .info-item:last-child {
            border-bottom: none;
        }
        .template-5 .info-label {
            font-weight: 700;
            color: #424242;
            font-size: 12.5pt;
            min-width: 35%;
            margin-right: 0.5cm;
        }
        .template-5 .info-value {
            color: #212121;
            font-size: 13.5pt;
            font-weight: 600;
            flex: 1;
        }

        /* Template 6: Học bố cục 1 cột 3 dấu từ mẫu 3 */
        .template-6 .info-section {
            margin: -0.4cm auto;
            max-width: 18cm;
            display: block;
            background: transparent;
            border: none;
            padding: 0;
        }
        .template-6 .info-item {
            display: grid; /* 2 cột: nhãn | nội dung */
            grid-template-columns: 48% 1fr; /* đảm bảo 'Giáo viên hướng dẫn' không bị cắt */
            align-items: start;
            column-gap: 10pt;
            margin: 8pt 0;
            padding: 10pt 16pt;
            background: #ffffff;
            border: 1px solid rgba(38,166,154,0.22);
            border-radius: 10pt;
            box-shadow: 0 2px 8px rgba(38,166,154,0.12);
        }
        .template-6 .info-label {
            font-weight: 600;
            color: #26a69a;
            font-size: 12pt;
            white-space: normal; /* cho phép xuống dòng nếu cần */
            overflow: visible;
            text-overflow: initial;
            line-height: 1.4;
        }
        .template-6 .info-label::after { content: none; }
        .template-6 .info-value {
            color: #333;
            font-size: 13pt;
            line-height: 1.4;
            position: relative;
            padding-left: 0;
            white-space: normal; /* tự xuống dòng khi dài */
            overflow: visible;
            text-overflow: initial;
            word-break: break-word;
            hyphens: auto;
        }
        .template-6 .info-value::before { content: ""; }

        /* Template 7: Sáng tạo – Bố cục card nghệ thuật */
        .template-7 .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.2cm;
            margin: 0.3cm auto;
            max-width: 16cm;
        }
        .template-7 .info-item {
            margin-bottom: 0.6cm;
            padding: 0.7cm;
            background: linear-gradient(135deg, rgba(66,66,66,0.08), rgba(97,97,97,0.08));
            border: 2pt solid rgba(66,66,66,0.3);
            border-radius: 12pt;
            box-shadow: 0 4px 15px rgba(66,66,66,0.12);
            position: relative;
            overflow: hidden;
        }
        .template-7 .info-item::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; height: 4pt;
            background: linear-gradient(90deg, rgba(66,66,66,0.4), rgba(97,97,97,0.4));
        }
        .template-7 .info-label {
            font-weight: 700;
            color: #424242;
            font-size: 12pt;
            margin-bottom: 0.3cm;
        }
        .template-7 .info-value {
            color: #333;
            font-size: 13pt;
            font-weight: 500;
        }

        /* Template 8: Hiện đại – Bố cục gradient 3D */
        .template-8 .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5cm;
            margin: 0.4cm auto;
            max-width: 16cm;
        }
        .template-8 .info-item {
            margin-bottom: 0.7cm;
            padding: 0.8cm;
            background: linear-gradient(135deg, rgba(97,97,97,0.12), rgba(117,117,117,0.12));
            border: 2pt solid transparent;
            border-radius: 15pt;
            position: relative;
            box-shadow: 0 6px 20px rgba(97,97,97,0.15);
        }
        .template-8 .info-item::before {
            content: "";
            position: absolute;
            inset: -2pt;
            border-radius: 15pt;
            background: linear-gradient(45deg, rgba(66,66,66,0.4), rgba(97,97,97,0.4));
            z-index: -1;
        }
        .template-8 .info-label {
            font-weight: 700;
            color: #616161;
            font-size: 12pt;
            margin-bottom: 0.3cm;
        }
        .template-8 .info-value {
            color: #333;
            font-size: 13pt;
            font-weight: 500;
        }

        /* Template 9: Hiện đại – Bố cục card gradient sang trọng */
        .template-9 .info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.3cm;
            margin: 0.4cm auto;
            max-width: 16cm;
        }
        .template-9 .info-item {
            margin-bottom: 0.7cm;
            padding: 0.8cm;
            background: linear-gradient(135deg, rgba(30,58,138,0.1), rgba(59,130,246,0.1));
            border: 2pt solid transparent;
            border-radius: 14pt;
            position: relative;
            box-shadow: 0 5px 18px rgba(30,58,138,0.12);
            overflow: hidden;
        }
        .template-9 .info-item::before {
            content: "";
            position: absolute;
            inset: -2pt;
            border-radius: 14pt;
            background: linear-gradient(45deg, rgba(30,58,138,0.3), rgba(59,130,246,0.3));
            z-index: -1;
        }
        .template-9 .info-item::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; height: 4pt;
            background: linear-gradient(90deg, rgba(30,58,138,0.5), rgba(59,130,246,0.5));
        }
        .template-9 .info-label {
            font-weight: 700;
            color: #1e3a8a;
            font-size: 12pt;
            margin-bottom: 0.3cm;
            position: relative;
            z-index: 1;
        }
        .template-9 .info-value {
            color: #1f2937;
            font-size: 13pt;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .info-panel { 
            border: none; 
            background: transparent; 
            padding: 0.2cm; 
            border-radius:10pt; 
            box-shadow: none; 
            position: relative;
            z-index: 1;
        }

        /* Card effect */
        .topic-section { border-radius: 10pt; box-shadow: 0 3px 12px rgba(0,0,0,0.08); }

        /* Keep cards inside page */
        .topic-section, .info-panel { max-width: 16cm; margin-left: auto; margin-right: auto; }
        
        /* Ensure footer is always visible */
        .footer-section {
            position: relative !important;
            z-index: 10 !important;
        }
        
        /* Ensure all content is visible */
        .university-name, .logo-placeholder, .subject-name, .topic-title, .topic-content, .info-label, .info-value {
            position: relative;
            z-index: 2;
        }

        /* Line layout helpers */
        .line-item { position: relative; display: flex; align-items: baseline; gap: 8px; margin: 10px 0; }
        .line-item .label { font-weight: bold; white-space: nowrap; }
        .line-item .dots { flex: 1; border-bottom: 1px dotted #000; height: 0; }
        .line-item .value { position: absolute; left: 220px; right: 0; top: -2px; background: #fff; padding: 0 4px; }
        .line-item .value span { background: #fff; }

        .colon-table { width: 100%; border-collapse: separate; border-spacing: 0 6px; font-size: 14pt; table-layout: auto; }
        .colon-table td { padding: 6px 8px; vertical-align: top; }
        .colon-table td.label { font-weight: bold; width: 42%; white-space: nowrap; word-break: keep-all; line-height: 1.3; }
        .colon-table td.colon { width: 10px; font-weight: bold; }
        .colon-table td.value { white-space: nowrap; }

        .info-one-col { text-align: left; max-width: 14cm; margin: 0 auto; }
        .info-one-col .info-block { margin: 6px 0; }
        .info-table { width: 100%; border-collapse: collapse; }
        .info-table td { padding: 6px 8px; font-size: 14pt; }
        .info-table td.label { font-weight: bold; width: 40%; }
        .rule-line { border-bottom: 1pt solid #9e9e9e; height: 0; }

        .info-item {
            margin-bottom: 0.5cm;
        }

        .info-label {
            font-weight: bold;
            font-size: 14pt;
            margin-bottom: 0.2cm;
            display: block;
        }

        .info-value {
            font-size: 14pt;
            line-height: 1.25;
        }

        .footer-section {
            text-align: center;
            margin-top: 1cm;
            padding-top: 0.6cm;
            border-top: 2pt solid #000;
            font-weight: bold;
            font-size: 13pt;
            flex-shrink: 0;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 10 !important;
            background: #fff !important;
            min-height: 1.5cm;
        }

        /* Soft footer accents for non-template-2 */
        .cover-preview.template-1 .footer-section,
        .cover-preview.template-4 .footer-section,
        .cover-preview.template-5 .footer-section,
        .cover-preview.template-6 .footer-section,
        .cover-preview.template-7 .footer-section,
        .cover-preview.template-8 .footer-section,
        .cover-preview.template-9 .footer-section {
            border-top: none;
            position: relative;
        }
        .cover-preview.template-1 .footer-section::before,
        .cover-preview.template-4 .footer-section::before,
        .cover-preview.template-5 .footer-section::before,
        .cover-preview.template-6 .footer-section::before,
        .cover-preview.template-7 .footer-section::before,
        .cover-preview.template-8 .footer-section::before,
        .cover-preview.template-9 .footer-section::before {
            content: "";
            display: block;
            height: 1.5pt;
            width: 55%;
            margin: 0 auto 0.45cm;
            border-radius: 2pt;
            background: rgba(0,0,0,0.2);
        }
        
        /* Template 3 specific footer accent */
        .cover-preview.template-3 .footer-section {
            border-top: none;
            position: relative;
        }
        .cover-preview.template-3 .footer-section::before {
            content: "";
            display: block;
            height: 1.5pt;
            width: 55%;
            margin: 0 auto 0.45cm;
            border-radius: 2pt;
            background: rgba(182, 142, 46, 0.4);
        }
        
        /* Template-specific footer accents */
        .cover-preview.template-3 .footer-section::before {
            background: rgba(182, 142, 46, 0.4);
        }
        .cover-preview.template-7 .footer-section::before {
            background: linear-gradient(90deg, rgba(66,66,66,0.4), rgba(97,97,97,0.4));
        }
        .cover-preview.template-8 .footer-section::before {
            background: linear-gradient(90deg, rgba(97,97,97,0.4), rgba(117,117,117,0.4));
        }
        .cover-preview.template-9 .footer-section::before {
            background: linear-gradient(90deg, rgba(30,58,138,0.4), rgba(59,130,246,0.4));
        }

        /* Border templates for preview */
        .cover-preview { position: relative; background: #fff; }
        .cover-preview::before, .cover-preview::after { z-index: 0; }
        /* Raise footer for template-1 */
        .cover-preview.template-1 .cover-content { padding-bottom: 1.2cm; justify-content: flex-start; }
        .cover-preview.template-1 .footer-section { margin-top: -0.2cm; padding-top: 0.2cm; }
        /* Raise footer for template-3 */
        .cover-preview.template-3 .cover-content { padding-bottom: 1.2cm; }
        /* Raise footer for template-2 */
        .cover-preview.template-2 .cover-content { padding-bottom: 1.2cm; }
        .cover-preview.template-2 .footer-section { margin-top: -0.2cm; padding-top: 0.2cm; }
        /* Raise info/footer for template-4 */
        .cover-preview.template-4 .cover-content { padding-bottom: 1.2cm; }
        .cover-preview.template-4 .footer-section { margin-top: 0.2cm; padding-top: 0.2cm; }
        .cover-preview.template-4 .logo-placeholder { width: 7.8cm; height: 7.8cm; }
        
        /* 1. Tinh hoa mới – Khung gradient thanh lịch (học từ 2,5,6) */
        .cover-preview.template-1 {
            position: relative;
            margin: 1.2cm;
            border-radius: 14pt;
            border: 4pt solid transparent;
            background:
              linear-gradient(#ffffff, #ffffff) padding-box,
              linear-gradient(135deg, #5c6bc0, #bdbdbd, #7e57c2) border-box;
            box-shadow: 0 12px 34px rgba(26,35,126,0.20), inset 0 0 0 1px rgba(255,255,255,0.6);
            overflow: visible;
        }
        .cover-preview.template-1::before {
            content: "";
            position: absolute;
            top: 0.9cm; left: 0.9cm; right: 0.9cm; bottom: 0.9cm;
            border-radius: 10pt;
            background: radial-gradient(circle at 25% 25%, rgba(102,126,234,0.06), transparent 60%),
                        radial-gradient(circle at 75% 75%, rgba(118,75,162,0.06), transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        .cover-preview.template-1 .content-frame { background: transparent; }

        /* 2. Hiện đại – Khung tối giản + Ribbon trên/dưới */
        .cover-preview.template-2 { 
            position: relative;
            margin: 1.2cm;
            border: 3pt solid #5c6bc0; /* indigo lighten */
            border-radius: 10pt;
            background: 
                linear-gradient(135deg, rgba(92,107,192,0.05), rgba(92,107,192,0.08));
            box-shadow: 0 8px 24px rgba(92,107,192,0.2);
        }
        .cover-preview.template-2::before,
        .cover-preview.template-2::after {
            content: "";
            position: absolute;
            left: 1.2cm;
            right: 1.2cm;
            height: 6pt;
            border-radius: 6pt;
            background: linear-gradient(90deg, rgba(102,126,234,0.35), rgba(118,75,162,0.35), rgba(240,147,251,0.35));
            z-index: 0;
        }
        .cover-preview.template-2::before { top: 1.2cm; }
        .cover-preview.template-2::after { bottom: 1.2cm; }
        .cover-preview.template-2 .content-frame { background: transparent; }
        .cover-preview.template-2 .footer-section { border-top: none; padding-top: 0.3cm; margin-top: 0.8cm; background: transparent !important; position: relative; z-index: 1; }
        /* Ensure ribbons render in PDF by duplicating them inside preview during export */
        .cover-preview.template-2 .footer-section::before {
            content: "";
            display: block;
            height: 1.5pt;
            width: 50%;
            margin: 0 auto 0.45cm;
            border-radius: 2pt;
            background: linear-gradient(90deg, rgba(102,126,234,0.35), rgba(118,75,162,0.35), rgba(240,147,251,0.35));
        }

        /* 3. Cổ điển – Viền hoa văn Baroque */
        .cover-preview.template-3 { 
            border: 5pt solid #b68e2e; 
            position: relative;
            margin: 1.2cm;
            background: #fff;
        }
        .cover-preview.template-3::before {
            content: "";
            position: absolute;
            top: 0.8cm; left: 0.8cm; right: 0.8cm; bottom: 0.8cm;
            border: 3pt solid #b68e2e;
            pointer-events: none;
        }
        .cover-preview.template-3::after {
            content: "";
            position: absolute;
            top: 1cm; left: 1cm; right: 1cm; bottom: 1cm;
            border: 2pt solid #b68e2e;
            pointer-events: none;
        }
        .cover-preview.template-3 .corner-ornament {
            position: absolute;
            width: 2.6cm;
            height: 2.6cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 35" fill="%23b68e2e"><path d="M17.5 5c-8 0-15 7-15 15s7 15 15 15 15-7 15-15-7-15-15-15zm0 25c-5 0-10-5-10-10s5-10 10-10 10 5 10 10-5 10-10 10z"/><path d="M17.5 10c-3 0-5 2-5 5s2 5 5 5 5-2 5-5-2-5-5-5zm0 8c-2 0-3-1-3-3s1-3 3-3 3 1 3 3-1 3-3 3z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.8;
            filter: drop-shadow(0 3px 6px rgba(182, 142, 46, 0.4));
        }

        /* 4. Á Đông – Viền hoa sen truyền thống */
        .cover-preview.template-4 { 
            border: 2.5pt solid #2e7d32; 
            position: relative;
            margin: 1.2cm;
            border-radius: 8pt;
            background: 
                radial-gradient(circle at 30% 30%, rgba(46, 125, 50, 0.05) 0%, transparent 60%),
                radial-gradient(circle at 70% 70%, rgba(46, 125, 50, 0.05) 0%, transparent 60%);
        }
        /* Template-4 color sync */
        .cover-preview.template-4 .university-name,
        .cover-preview.template-4 .subject-name { color: #2e7d32; }
        .cover-preview.template-4 .topic-title { color: #2e7d32; }
        .cover-preview.template-4 .footer-section::before {
            background: linear-gradient(90deg, rgba(46,125,50,0.35), rgba(76,175,80,0.35));
        }
        .cover-preview.template-4 .info-label::after { color: #2e7d32; }
        .cover-preview.template-4::before {
            content: "";
            position: absolute;
            top: 0.6cm; left: 0.6cm; right: 0.6cm; bottom: 0.6cm;
            border: 1pt solid #2e7d32;
            border-radius: 6pt;
            pointer-events: none;
        }
        .cover-preview.template-4 .lotus-ornament {
            position: absolute;
            width: 2.6cm;
            height: 2.6cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="%232e7d32"><path d="M16 4c-4 0-8 4-8 8s4 8 8 8 8-4 8-8-4-8-8-8zm0 20c-4 0-8 4-8 8s4 8 8 8 8-4 8-8-4-8-8-8zm-12 8c0-4 4-8 8-8s8 4 8 8-4 8-8 8-8-4-8-8z"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.8;
            filter: drop-shadow(0 2px 4px rgba(46, 125, 50, 0.3));
        }
        .cover-preview.template-4 .lotus-ornament.tl { top: 18px; left: 18px; }
        .cover-preview.template-4 .lotus-ornament.tr { top: 18px; right: 18px; transform: scaleX(-1); }
        .cover-preview.template-4 .lotus-ornament.bl { bottom: 18px; left: 18px; transform: scaleY(-1); }
        .cover-preview.template-4 .lotus-ornament.br { bottom: 18px; right: 18px; transform: scale(-1, -1); }

        /* 5. Sang trọng – Viền metallic 3D */
        /* Template-5 new border: Art Deco double frame with corner lines */
        .cover-preview.template-5 { 
            position: relative;
            margin: 1.2cm;
            background: #fff;
            border: 3pt solid #7a7a7a;
            box-shadow: 0 6px 20px rgba(0,0,0,0.10);
        }
        .cover-preview.template-5::before {
            content: "";
            position: absolute;
            top: 0.9cm; left: 0.9cm; right: 0.9cm; bottom: 0.9cm;
            border: 2pt solid #bdbdbd;
            pointer-events: none;
        }
        .cover-preview.template-5::after {
            content: "";
            position: absolute;
            left: 1.6cm; right: 1.6cm; top: 1.1cm;
            height: 2pt;
            background: linear-gradient(90deg, rgba(189,189,189,0), rgba(158,158,158,0.9), rgba(189,189,189,0));
            pointer-events: none;
        }
        .cover-preview.template-5 .corner-ornament {
            position: absolute;
            width: 2.6cm; height: 2.6cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" fill="%239e9e9e"><path d="M6 26c10-8 8-18 20-22-4 8-2 16 8 20-12 2-18 10-20 20-4-8-12-8-8-18z" opacity=".8"/><path d="M10 42c6-6 12-6 20-8-6 4-8 10-10 16-4-4-8-4-10-8z" opacity=".7"/></svg>');
            background-repeat: no-repeat; background-size: contain; opacity: 0.9; filter: drop-shadow(0 3px 6px rgba(0,0,0,0.2));
        }
        .cover-preview.template-5 .corner-ornament.tl { top: 18px; left: 18px; }
        .cover-preview.template-5 .corner-ornament.tr { top: 18px; right: 18px; transform: scaleX(-1); }
        .cover-preview.template-5 .corner-ornament.bl { bottom: 18px; left: 18px; transform: scaleY(-1); }
        .cover-preview.template-5 .corner-ornament.br { bottom: 18px; right: 18px; transform: scale(-1,-1); }

        /* Side floral vines */
        .cover-preview.template-5 .content-frame::before,
        .cover-preview.template-5 .content-frame::after {
            content: "";
            position: absolute;
            top: 1.6cm; bottom: 2.2cm;
            width: 0.5cm;
            background-repeat: repeat-y;
            background-size: contain;
            opacity: 0.25;
        }
        .cover-preview.template-5 .content-frame::before {
            left: -0.8cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 100" fill="%239e9e9e"><path d="M5 0v100" stroke="%239e9e9e" stroke-width="0.6"/><circle cx="5" cy="10" r="1.8"/><circle cx="5" cy="28" r="1.6"/><circle cx="5" cy="46" r="1.8"/><circle cx="5" cy="64" r="1.6"/><circle cx="5" cy="82" r="1.8"/></svg>');
        }
        .cover-preview.template-5 .content-frame::after {
            right: -0.8cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 100" fill="%239e9e9e"><path d="M5 0v100" stroke="%239e9e9e" stroke-width="0.6"/><rect x="3.5" y="8" width="3" height="3" rx="1.5"/><rect x="3.5" y="26" width="3" height="3" rx="1.5"/><rect x="3.5" y="44" width="3" height="3" rx="1.5"/><rect x="3.5" y="62" width="3" height="3" rx="1.5"/><rect x="3.5" y="80" width="3" height="3" rx="1.5"/></svg>');
        }

        /* 6. Mới – Viền hiện đại dịu mắt (học cấu trúc mẫu 3) */
        .cover-preview.template-6 { 
            position: relative;
            margin: 1.2cm;
            border-radius: 16pt;
            border: 3pt solid transparent;
            background: 
              linear-gradient(#ffffff, #ffffff) padding-box,
              linear-gradient(45deg, #26a69a, #b8cbb8, #26a69a) border-box;
            box-shadow: 0 10px 26px rgba(38,166,154,0.14);
            overflow: visible;
        }
        .cover-preview.template-6::before {
            content: "";
            position: absolute;
            top: 0.7cm; left: 0.7cm; right: 0.7cm; bottom: 0.7cm;
            border-radius: 12pt;
            background: radial-gradient(circle at 20% 20%, rgba(38,166,154,0.16), transparent 60%),
                        radial-gradient(circle at 80% 80%, rgba(184,203,184,0.16), transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        /* Ensure inner content stays above decorative layers and away from border */
        .cover-preview.template-6 .cover-content { position: relative; z-index: 1; padding-top: 1.6cm; }
        .cover-preview.template-6 .content-frame { background: transparent; }
        /* Side waves inspired by sóng nước */
        .cover-preview.template-6 .content-frame::before,
        .cover-preview.template-6 .content-frame::after {
            content: "";
            position: absolute;
            top: 1.6cm; bottom: 2.2cm;
            width: 0.5cm;
            background-repeat: repeat-y;
            background-size: contain;
            opacity: 0.25;
            filter: drop-shadow(0 2px 4px rgba(38,166,154,0.15));
            z-index: 0;
        }
        .cover-preview.template-6 .content-frame::before {
            left: -0.8cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 120" fill="none"><path d="M6 0 C10 6 2 12 6 18 C10 24 2 30 6 36 C10 42 2 48 6 54 C10 60 2 66 6 72 C10 78 2 84 6 90 C10 96 2 102 6 108 C10 114 2 120 6 126" stroke="%2326a69a" stroke-width="1.2"/></svg>');
        }
        .cover-preview.template-6 .content-frame::after {
            right: -0.8cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 120" fill="none"><path d="M6 0 C2 6 10 12 6 18 C2 24 10 30 6 36 C2 42 10 48 6 54 C2 60 10 66 6 72 C2 78 10 84 6 90 C2 96 10 102 6 108 C2 114 10 120 6 126" stroke="%2326a69a" stroke-width="1.2"/></svg>');
        }
        /* Corner clouds (mây) */
        .cover-preview.template-6 .wave-ornament {
            position: absolute;
            width: 2.6cm; height: 2.6cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="%2326a69a"><path d="M20 40c-6 0-10-4-10-9s4-9 10-9c1 0 2 0 3 .2C25 17 30 14 36 14c9 0 16 6 16 14 5 1 8 5 8 10s-5 10-12 10H20z" opacity="0.7"/></svg>');
            background-repeat: no-repeat; background-size: contain; opacity: 0.7;
            filter: drop-shadow(0 3px 6px rgba(38,166,154,0.3));
            display: block;
        }
        .cover-preview.template-6 .wave-ornament.tl { top: 22px; left: 22px; }
        .cover-preview.template-6 .wave-ornament.tr { top: 22px; right: 22px; transform: scaleX(-1); }
        .cover-preview.template-6 .wave-ornament.bl { bottom: 22px; left: 22px; transform: scaleY(-1); }
        .cover-preview.template-6 .wave-ornament.br { bottom: 22px; right: 22px; transform: scale(-1, -1); }

        /* 7. Sáng tạo – Viền hoa văn cổ đại */
        .cover-preview.template-7 { 
            position: relative;
            margin: 1.2cm;
            border: 4pt solid #424242;
            border-radius: 8pt;
            background: #ffffff;
            box-shadow: 0 8px 25px rgba(66,66,66,0.15);
        }
        .cover-preview.template-7::before {
            content: "";
            position: absolute;
            top: 0.6cm; left: 0.6cm; right: 0.6cm; bottom: 0.6cm;
            border: 2pt solid #616161;
            border-radius: 6pt;
            pointer-events: none;
        }
        .cover-preview.template-7::after {
            content: "";
            position: absolute;
            top: 1cm; left: 1cm; right: 1cm; bottom: 1cm;
            border: 1pt solid #9e9e9e;
            border-radius: 4pt;
            pointer-events: none;
        }
        .cover-preview.template-7 .content-frame { background: transparent; }
        .cover-preview.template-7 .artistic-ornament {
            position: absolute;
            width: 2.8cm; height: 2.8cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56" fill="%23424242"><path d="M28 4c-6 0-12 6-12 12s6 12 12 12 12-6 12-12-6-12-12-12zm0 20c-4 0-8-4-8-8s4-8 8-8 8 4 8 8-4 8-8 8z" opacity="0.7"/><path d="M28 16c-2 0-4 2-4 4s2 4 4 4 4-2 4-4-2-4-4-4z" opacity="0.5"/><circle cx="28" cy="28" r="6" opacity="0.3"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.6;
            filter: drop-shadow(0 3px 6px rgba(66,66,66,0.3));
        }
        .cover-preview.template-7 .artistic-ornament.tl { top: 15px; left: 15px; }
        .cover-preview.template-7 .artistic-ornament.tr { top: 15px; right: 15px; transform: scaleX(-1); }
        .cover-preview.template-7 .artistic-ornament.bl { bottom: 15px; left: 15px; transform: scaleY(-1); }
        .cover-preview.template-7 .artistic-ornament.br { bottom: 15px; right: 15px; transform: scale(-1, -1); }

        /* 8. Hiện đại – Viền hoa văn cổ điển */
        .cover-preview.template-8 { 
            position: relative;
            margin: 1.2cm;
            border: 3pt solid #616161;
            border-radius: 10pt;
            background: #ffffff;
            box-shadow: 0 10px 30px rgba(97,97,97,0.2);
        }
        .cover-preview.template-8::before {
            content: "";
            position: absolute;
            top: 0.7cm; left: 0.7cm; right: 0.7cm; bottom: 0.7cm;
            border: 2pt solid #757575;
            border-radius: 8pt;
            pointer-events: none;
        }
        .cover-preview.template-8::after {
            content: "";
            position: absolute;
            top: 1.2cm; left: 1.2cm; right: 1.2cm; bottom: 1.2cm;
            border: 1pt solid #bdbdbd;
            border-radius: 6pt;
            pointer-events: none;
        }
        .cover-preview.template-8 .content-frame { background: transparent; }
        .cover-preview.template-8 .gradient-ornament {
            position: absolute;
            width: 2.6cm; height: 2.6cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" fill="%23616161"><path d="M26 6c-5 0-10 5-10 10s5 10 10 10 10-5 10-10-5-10-10-10zm0 16c-3 0-6-3-6-6s3-6 6-6 6 3 6 6-3 6-6 6z" opacity="0.7"/><path d="M26 18c-1 0-2 1-2 2s1 2 2 2 2-1 2-2-1-2-2-2z" opacity="0.5"/><circle cx="26" cy="26" r="5" opacity="0.3"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.6;
            filter: drop-shadow(0 4px 8px rgba(97,97,97,0.3));
        }
        .cover-preview.template-8 .gradient-ornament.tl { top: 18px; left: 18px; }
        .cover-preview.template-8 .gradient-ornament.tr { top: 18px; right: 18px; transform: scaleX(-1); }
        .cover-preview.template-8 .gradient-ornament.bl { bottom: 18px; left: 18px; transform: scaleY(-1); }
        .cover-preview.template-8 .gradient-ornament.br { bottom: 18px; right: 18px; transform: scale(-1, -1); }

        /* 9. Hiện đại – Viền gradient xanh dương sang trọng */
        .cover-preview.template-9 { 
            position: relative;
            margin: 1.2cm;
            border-radius: 20pt;
            border: 4pt solid transparent;
            background: 
              linear-gradient(#ffffff, #ffffff) padding-box,
              linear-gradient(135deg, #1e3a8a, #3b82f6, #93c5fd, #1e3a8a) border-box;
            box-shadow: 0 15px 40px rgba(30,58,138,0.25);
            overflow: visible;
        }
        .cover-preview.template-9::before {
            content: "";
            position: absolute;
            top: 0.8cm; left: 0.8cm; right: 0.8cm; bottom: 0.8cm;
            border-radius: 16pt;
            background: radial-gradient(circle at 25% 25%, rgba(30,58,138,0.08), transparent 60%),
                        radial-gradient(circle at 75% 75%, rgba(59,130,246,0.08), transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        .cover-preview.template-9 .content-frame { background: transparent; }
        .cover-preview.template-9 .elegant-ornament {
            position: absolute;
            width: 3cm; height: 3cm;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60" fill="url(%23blueGrad)"><defs><linearGradient id="blueGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%231e3a8a;stop-opacity:0.8"/><stop offset="50%" style="stop-color:%233b82f6;stop-opacity:0.8"/><stop offset="100%" style="stop-color:%2393c5fd;stop-opacity:0.8"/></linearGradient></defs><path d="M30 5c-8 0-15 7-15 15s7 15 15 15 15-7 15-15-7-15-15-15zm0 25c-5 0-10-5-10-10s5-10 10-10 10 5 10 10-5 10-10 10z" opacity="0.7"/><circle cx="30" cy="30" r="8" opacity="0.5"/><circle cx="30" cy="30" r="4" opacity="0.8"/></svg>');
            background-repeat: no-repeat;
            background-size: contain;
            opacity: 0.7;
            filter: drop-shadow(0 5px 12px rgba(30,58,138,0.4));
        }
        .cover-preview.template-9 .elegant-ornament.tl { top: 20px; left: 20px; }
        .cover-preview.template-9 .elegant-ornament.tr { top: 20px; right: 20px; transform: scaleX(-1); }
        .cover-preview.template-9 .elegant-ornament.bl { bottom: 20px; left: 20px; transform: scaleY(-1); }
        .cover-preview.template-9 .elegant-ornament.br { bottom: 20px; right: 20px; transform: scale(-1, -1); }

        /* Ornament positioning and styling */
         .corner-ornament, .lotus-ornament, .wave-ornament, .cube-3d, .bottom-stripe, .gothic-rose, .artistic-ornament, .gradient-ornament, .elegant-ornament {
             position: absolute;
             pointer-events: none;
             z-index: 0;
         }
        
        /* Hide all ornaments by default */
        .corner-ornament, .lotus-ornament, .wave-ornament, .cube-3d, .bottom-stripe, .artistic-ornament, .gradient-ornament, .elegant-ornament {
            display: none;
        }

        /* Template-specific ornament styles */
        .cover-preview.template-3 .bottom-stripe {
            position: absolute;
            left: 1.2cm;
            right: 1.2cm;
            bottom: 1.2cm;
            height: 6pt;
            background: rgba(182, 142, 46, 0.3);
            border-radius: 3pt;
        }
        
        /* Hide ornaments for the new template-1 */
        .cover-preview.template-1 .corner-ornament { display: none; }
        /* Raise footer/time for template-5 and template-4 */
        .cover-preview.template-5 .footer-section { margin-top: 0.2cm; padding-top: 0.2cm; }
        .cover-preview.template-4 .footer-section { margin-top: -0.2cm; padding-top: 0.1cm; }
        .cover-preview.template-6 .footer-section { margin-top: -0.2cm; padding-top: 0.1cm; }
        .cover-preview.template-7 .footer-section { margin-top: -0.2cm; padding-top: 0.1cm; }
        .cover-preview.template-8 .footer-section { margin-top: -0.2cm; padding-top: 0.1cm; }
        .cover-preview.template-9 .footer-section { margin-top: -0.2cm; padding-top: 0.1cm; }
        
        /* Global raise: move info section and footer up by 1.5cm across all templates */
        .cover-preview .info-panel { transform: translateY(-1.5cm); }
        .cover-preview .footer-section { transform: translateY(-1.5cm); }

        /* Raise topic box up by additional 1cm for templates 2,3,4,5,6 */
        .cover-preview.template-2 .topic-section { margin-top: -1.5cm; }
        .cover-preview.template-3 .topic-section { margin-top: -1.5cm; }
        .cover-preview.template-4 .topic-section { margin-top: -1.5cm; }
        .cover-preview.template-5 .topic-section { margin-top: -1.5cm; }
        .cover-preview.template-6 .topic-section { margin-top: -1.5cm; }
        .cover-preview.template-7 .topic-section { margin-top: -1.5cm; }
        .cover-preview.template-8 .topic-section { margin-top: -1.5cm; }
        .cover-preview.template-9 .topic-section { margin-top: -1.5cm; }
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .info-section {
                grid-template-columns: 1fr;
            }
            .cover-preview { transform: scale(0.5); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Tạo Bìa Word - Phiên Bản Cuối</h1>
            <p>Layout gọn gàng, khoảng cách chuẩn, xuất PDF</p>
            <div style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
                <strong>Hướng dẫn:</strong> Điền thông tin → Chọn "Tạo PDF" → File sẽ tải về
            </div>
        </div>

        <div class="main-content">
            <div class="form-section">
                <h3>Thông tin bìa</h3>
                
                <div class="form-group">
                    <label for="university">Tên trường:</label>
                    <input type="text" id="university" value="ĐẠI HỌC KINH TẾ QUỐC DÂN">
                </div>
                
                <div class="form-group">
                    <label for="subject">Tên môn học:</label>
                    <input type="text" id="subject" value="ĐỒ ÁN TỐT NGHIỆP">
                </div>
                
                <div class="form-group">
                    <label for="topic">Đề tài:</label>
                    <textarea id="topic" rows="2" placeholder="Nhập đề tài của bạn..."></textarea>
                </div>

                <div class="form-group">
                    <label for="logoInput">Logo trường (tùy chọn):</label>
                    <input type="file" id="logoInput" accept="image/*">
                    <button type="button" id="resetLogo" style="margin-top: 5px; padding: 5px 10px; background: #6c757d; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">🔄 Dùng logo NEU mặc định</button>
                </div>
                
                <div class="form-group">
                    <label for="studentName">Tên sinh viên:</label>
                    <input type="text" id="studentName" placeholder="Họ và tên sinh viên">
                </div>
                
                <div class="form-group">
                    <label for="studentId">Mã sinh viên:</label>
                    <input type="text" id="studentId" placeholder="Mã số sinh viên">
                </div>
                
                <div class="form-group">
                    <label for="className">Lớp:</label>
                    <input type="text" id="className" placeholder="Tên lớp">
                </div>
                
                <div class="form-group">
                    <label for="instructor">Giáo viên hướng dẫn:</label>
                    <input type="text" id="instructor" placeholder="Tên giáo viên hướng dẫn">
                </div>
                
                <div class="form-group">
                    <label for="location">Địa điểm:</label>
                    <input type="text" id="location" value="Hà Nội">
                </div>
                
                <div class="form-group">
                    <label for="date">Ngày tháng:</label>
                    <input type="text" id="date" placeholder="Tháng/Năm">
                </div>
            </div>

            <div class="template-section">
                <h3>Tạo file</h3>
                <div class="form-group">
                    <label for="borderStyle">Chọn viền bìa:</label>
                                         <select id="borderStyle">
                          <option value="template-1">1. Tinh hoa mới – Khung gradient thanh lịch</option>
                          <option value="template-2">2. Hiện đại – Viền gradient ánh kim</option>
                          <option value="template-3">3. Cổ điển – Viền hoa văn Baroque</option>
                          <option value="template-4">4. Á Đông – Viền hoa sen truyền thống</option>
                          <option value="template-5">5. Sang trọng – Viền metallic 3D</option>
                          <option value="template-6" selected>6. Mới – Viền hiện đại dịu mắt</option>
                          <option value="template-7">7. Sáng tạo – Viền hoa văn cổ đại</option>
                          <option value="template-8">8. Hiện đại – Viền hoa văn cổ điển</option>
                          <option value="template-9">9. Hiện đại – Viền gradient xanh dương sang trọng</option>
                     </select>
                </div>
                
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="generateCombinedPDF()">🎨 Tạo Ảnh Bìa</button>
                </div>
                
                <div style="margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="fillSample()" style="width: 100%;">Điền Dữ Liệu Mẫu</button>
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: #e9ecef; border-radius: 8px; font-size: 12px;">
                    <strong>Lưu ý:</strong><br>
                    • Layout được tối ưu cho 1 trang A4<br>
                    • Khoảng cách dòng: 1.25<br>
                    • Font: Times New Roman, 13pt<br>
                    • Margin: 1.5cm tất cả cạnh
                </div>
            </div>

            <div class="preview-section">
                <h3>Xem Trước (Tỷ lệ A4)</h3>
                <div class="preview-container">
                    <div class="preview-image">
                        <h4>Ảnh PNG (Copy luôn)</h4>
                        <div id="coverImage">
                            <div class="placeholder">
                                Click "🎨 Tạo Ảnh Bìa" để hiện ảnh
                            </div>
                        </div>
                    </div>
                    
                    <div class="preview-html">
                        <h4>Preview HTML</h4>
                        <div class="cover-preview template-6" id="coverPreview">
                    <!-- Template 1: Corner ornaments -->
                    <div class="corner-ornament tl"></div>
                    <div class="corner-ornament tr"></div>
                    <div class="corner-ornament bl"></div>
                    <div class="corner-ornament br"></div>
                    
                    <!-- Template 3: Bottom stripe -->
                    <div class="bottom-stripe"></div>
                    
                    <!-- Template 4: Lotus ornaments -->
                    <div class="lotus-ornament tl"></div>
                    <div class="lotus-ornament tr"></div>
                    <div class="lotus-ornament bl"></div>
                    <div class="lotus-ornament br"></div>
                    
                    <!-- Template 6: Wave ornaments -->
                    <div class="wave-ornament tl"></div>
                    <div class="wave-ornament tr"></div>
                    <div class="wave-ornament bl"></div>
                    <div class="wave-ornament br"></div>
                    
                    <!-- Template 7: Artistic ornaments -->
                    <div class="artistic-ornament tl"></div>
                    <div class="artistic-ornament tr"></div>
                    <div class="artistic-ornament bl"></div>
                    <div class="artistic-ornament br"></div>
                    
                    <!-- Template 8: Gradient ornaments -->
                    <div class="gradient-ornament tl"></div>
                    <div class="gradient-ornament tr"></div>
                    <div class="gradient-ornament bl"></div>
                    <div class="gradient-ornament br"></div>
                    
                    <!-- Template 9: Elegant ornaments -->
                    <div class="elegant-ornament tl"></div>
                    <div class="elegant-ornament tr"></div>
                    <div class="elegant-ornament bl"></div>
                    <div class="elegant-ornament br"></div>
                    
                    
                    <div class="cover-content">
                        <div class="content-frame">
                        <div class="header-section">
                            <div class="university-name" id="previewUniversity">ĐẠI HỌC KINH TẾ QUỐC DÂN</div>
                            <div class="logo-placeholder" id="logoBox"><img id="defaultLogo" src="logo-neu-inkythuatso-01-09-10-41-01 (1).jpg" alt="NEU Logo"></div>
                            <div class="subject-name" id="previewSubject">ĐỒ ÁN TỐT NGHIỆP</div>
                            <div class="header-accent accent-6" id="headerAccent"></div>
                        </div>
                        
                        <div class="topic-section topic-variant-6" id="topicBox">
                            <div class="topic-title">ĐỀ TÀI:</div>
                            <div class="topic-content" id="previewTopic">Nhập đề tài của bạn...</div>
                        </div>
                        
                        <div class="info-panel">
                        <div class="info-section">
                                <div class="info-item">
                                    <span class="info-label">Họ và Tên</span>
                                    <div class="info-value" id="previewStudent">Tên sinh viên</div>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">MSV</span>
                                    <div class="info-value" id="previewId">Mã sinh viên</div>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Lớp</span>
                                    <div class="info-value" id="previewClass">Tên lớp</div>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">GV Hướng Dẫn</span>
                                    <div class="info-value" id="previewInstructor">Giáo viên hướng dẫn</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="footer-section">
                            <span id="previewLocation">Hà Nội</span>, <span id="previewDate">Tháng/Năm</span>
                        </div>
                        </div>
                    </div>
                                        </div>
                </div>
            </div>
        </div>


    </div>

    <script>
        // Form inputs
        const inputs = ['university', 'subject', 'topic', 'studentName', 'studentId', 'className', 'instructor', 'location', 'date'];
        inputs.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', updatePreview);
            }
        });

        // Border template handling
        const coverPreview = document.getElementById('coverPreview');
        const borderStyleSelect = document.getElementById('borderStyle');
        function applyBorderTemplate() {
            if (!coverPreview) return;
            const tpl = borderStyleSelect ? borderStyleSelect.value : 'template-1';
            coverPreview.className = `cover-preview ${tpl}`;
            
                                      // Hide all ornaments first
             const allOrnaments = coverPreview.querySelectorAll('.corner-ornament, .lotus-ornament, .wave-ornament');
             allOrnaments.forEach(orn => orn.style.display = 'none');
             
             // Show ornaments based on template
             const templateNum = tpl.split('-')[1] || 1;
             switch(templateNum) {
                 case '1':
                     // New template-1 uses clean gradient frame; no ornaments
                     break;
                 case '2':
                     // Ribbon bars via CSS; no ornaments needed
                     break;
                 case '3':
                     coverPreview.querySelectorAll('.corner-ornament').forEach(orn => orn.style.display = 'block');
                     break;
                 case '4':
                     coverPreview.querySelectorAll('.lotus-ornament').forEach(orn => orn.style.display = 'block');
                     break;
                 case '5':
                     coverPreview.querySelectorAll('.corner-ornament').forEach(orn => orn.style.display = 'block');
                     break;
                 case '6':
                     coverPreview.querySelectorAll('.wave-ornament').forEach(orn => orn.style.display = 'block');
                     break;
                 case '7':
                     coverPreview.querySelectorAll('.artistic-ornament').forEach(orn => orn.style.display = 'block');
                     break;
                 case '8':
                     coverPreview.querySelectorAll('.gradient-ornament').forEach(orn => orn.style.display = 'block');
                     break;
                 case '9':
                     coverPreview.querySelectorAll('.elegant-ornament').forEach(orn => orn.style.display = 'block');
                     break;
             }
            
            const topicBox = document.getElementById('topicBox');
            if (topicBox) {
                topicBox.className = `topic-section topic-variant-${templateNum}`;
            }
            const accent = document.getElementById('headerAccent');
            if (accent) {
                accent.className = `header-accent accent-${templateNum}`;
            }
        }
        if (borderStyleSelect) {
            borderStyleSelect.addEventListener('change', applyBorderTemplate);
        }

        // Logo upload handling
        let logoDataUrl = '';
        const logoInput = document.getElementById('logoInput');
        const resetLogoBtn = document.getElementById('resetLogo');
        
        if (logoInput) {
            logoInput.addEventListener('change', (e) => {
                const file = e.target.files && e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = () => {
                    logoDataUrl = reader.result;
                    updateLogoPreview();
                };
                reader.readAsDataURL(file);
            });
        }
        
        if (resetLogoBtn) {
            resetLogoBtn.addEventListener('click', () => {
                logoDataUrl = '';
                logoInput.value = '';
                updateLogoPreview();
            });
        }

        function updateLogoPreview() {
            const logoBox = document.getElementById('logoBox');
            if (!logoBox) return;
            if (logoDataUrl) {
                logoBox.innerHTML = '<img id="previewLogo" alt="logo">';
                const img = document.getElementById('previewLogo');
                img.src = logoDataUrl;
            } else {
                // Trở về logo NEU mặc định
                logoBox.innerHTML = '<img id="defaultLogo" src="logo-neu-inkythuatso-01-09-10-41-01 (1).jpg" alt="NEU Logo">';
            }
        }

                 // Fixed info layout for each template
        // applyInfoLayoutPreview was unused; removed to simplify code

        function updatePreview() {
            const data = getFormData();
            
            document.getElementById('previewUniversity').textContent = data.university || '';
            document.getElementById('previewSubject').textContent = data.subject || '';
            document.getElementById('previewTopic').textContent = data.topic || 'Nhập đề tài của bạn...';
            const s = document.getElementById('previewStudent'); if (s) s.textContent = data.studentName || 'Tên sinh viên';
            const i = document.getElementById('previewId'); if (i) i.textContent = data.studentId || 'Mã sinh viên';
            const c = document.getElementById('previewClass'); if (c) c.textContent = data.className || 'Tên lớp';
            const t = document.getElementById('previewInstructor'); if (t) t.textContent = data.instructor || 'Giáo viên hướng dẫn';
            document.getElementById('previewLocation').textContent = data.location || 'Hà Nội';
            document.getElementById('previewDate').textContent = data.date || 'Tháng/Năm';
        }

        function getFormData() {
            return {
                university: document.getElementById('university').value,
                subject: document.getElementById('subject').value,
                topic: document.getElementById('topic').value,
                studentName: document.getElementById('studentName').value,
                studentId: document.getElementById('studentId').value,
                className: document.getElementById('className').value,
                instructor: document.getElementById('instructor').value,
                location: document.getElementById('location').value,
                date: document.getElementById('date').value
            };
        }

        function validateForm() {
            const data = getFormData();
            const required = ['subject', 'topic', 'studentName', 'studentId', 'className', 'instructor', 'location', 'date'];
            
            for (let field of required) {
                if (!data[field] || data[field].trim() === '') {
                    alert(`Vui lòng điền: ${getFieldName(field)}`);
                    document.getElementById(field).focus();
                    return false;
                }
            }
            return true;
        }

        function getFieldName(field) {
            const names = {
                subject: 'Tên môn học',
                topic: 'Đề tài',
                studentName: 'Tên sinh viên',
                studentId: 'Mã sinh viên',
                className: 'Lớp',
                instructor: 'Giáo viên hướng dẫn',
                location: 'Địa điểm',
                date: 'Ngày tháng'
            };
            return names[field];
        }




        function fillSample() {
            document.getElementById('university').value = 'ĐẠI HỌC KINH TẾ QUỐC DÂN';
            document.getElementById('subject').value = 'HỌC PHẦN TRIẾT HỌC';
            document.getElementById('topic').value = 'Nội dung và cơ sở lý luận của quan điểm toàn diện; liên hệ với thực tế đổi mới kinh tế ở Việt Nam hiện nay.';
            document.getElementById('studentName').value = 'Phạm Mạnh Đức';
            document.getElementById('studentId').value = '19245876';
            document.getElementById('className').value = 'TCNH34A';
            document.getElementById('instructor').value = 'TS Nguyễn Thị Lê Thư';
            document.getElementById('location').value = 'Hà Nội';
            document.getElementById('date').value = '09/2025';
            
            updatePreview();
            alert('Đã điền dữ liệu mẫu!');
        }

        // Auto-fill current date in 'tháng X năm YYYY'
        (function() {
            const now = new Date();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();
            document.getElementById('date').value = `tháng ${month} năm ${year}`;
        })();

        // Check for extension actions
        function checkExtensionActions() {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            
            if (action === 'createCoverImage') {
                // Tự động điền thông tin mẫu
                fillSample();
                updatePreview();
                
                // Chỉ thông báo, không tự động tạo ảnh
                setTimeout(() => {
                    alert('✅ Đã mở web app tạo bìa!\n\nHướng dẫn:\n1. Điều chỉnh thông tin nếu cần\n2. Click "🎨 Tạo Ảnh Bìa"\n3. Quay lại Google Docs\n4. Click "Chèn ảnh bìa vào Docs"');
                }, 1000);
            }
        }

        // Tạo ảnh bìa
        async function generateCoverImage() {
            try {
                console.log('🎨 Bắt đầu tạo ảnh bìa...');
                
                // Validate form trước
                if (!validateForm()) return;
                
                // Sử dụng trực tiếp HTML từ preview để đảm bảo giống hệt
                const coverPreview = document.getElementById('coverPreview');
                if (!coverPreview) {
                    alert('Không tìm thấy preview!');
                    return;
                }
                
                // Clone preview element để không ảnh hưởng đến preview gốc
                const clonedPreview = coverPreview.cloneNode(true);
                
                // Thêm CSS để đảm bảo hiển thị đúng trong ảnh
                const style = document.createElement('style');
                style.textContent = `
                    * { box-sizing: border-box; }
                    body { margin: 0; padding: 0; }
                    .cover-preview { 
                        transform: none !important; 
                        width: 21cm !important; 
                        height: 29.7cm !important; 
                        margin: 0 !important; 
                        overflow: visible !important;
                    }
                    .cover-content { 
                        height: 100% !important; 
                        overflow: visible !important;
                    }
                    .footer-section { 
                        display: block !important; 
                        visibility: visible !important; 
                        opacity: 1 !important; 
                        position: relative !important; 
                        z-index: 10 !important; 
                        background: #fff !important;
                    }
                `;
                clonedPreview.appendChild(style);
                
                // Tạo element tạm thời để render HTML
                const tempDiv = document.createElement('div');
                tempDiv.appendChild(clonedPreview);
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.top = '0';
                document.body.appendChild(tempDiv);
                
                // Tạo ảnh bìa từ HTML với cài đặt tối ưu
                const canvas = await html2canvas(clonedPreview, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    scrollX: 0,
                    scrollY: 0
                });
                
                // Xuất ảnh PNG
                const link = document.createElement('a');
                link.download = 'cover.png';
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                
                // Dọn dẹp
                document.body.removeChild(tempDiv);
                
                console.log('✅ Đã tạo ảnh bìa thành công!');
                
            } catch (error) {
                console.error('❌ Lỗi tạo ảnh bìa:', error);
                alert('Có lỗi khi tạo ảnh bìa. Vui lòng thử lại.');
            }
        }

        // Initial preview update
        updatePreview();
        applyBorderTemplate();
        checkExtensionActions();





        // Tạo ảnh bìa: cover only
        async function generateCombinedPDF() {
            if (!validateForm()) return;
            
            try {
                const data = getFormData();
                
                // Sử dụng trực tiếp HTML từ preview để đảm bảo giống hệt
                const coverPreview = document.getElementById('coverPreview');
                if (!coverPreview) {
                    alert('Không tìm thấy preview!');
                    return;
                }
                
                // Clone preview element để không ảnh hưởng đến preview gốc
                const clonedPreview = coverPreview.cloneNode(true);
                
                // For template-2, recreate ribbon bars inside the DOM (html2canvas sometimes misses ::before/::after)
                if (coverPreview.classList.contains('template-2')) {
                    const topRibbon = document.createElement('div');
                    const bottomRibbon = document.createElement('div');
                    Object.assign(topRibbon.style, {
                        position: 'absolute', left: '1.2cm', right: '1.2cm', top: '1.2cm', height: '6pt', borderRadius: '6pt',
                        background: 'linear-gradient(90deg, rgba(102,126,234,0.35), rgba(118,75,162,0.35), rgba(240,147,251,0.35))', zIndex: '0'
                    });
                    Object.assign(bottomRibbon.style, {
                        position: 'absolute', left: '1.2cm', right: '1.2cm', bottom: '1.2cm', height: '6pt', borderRadius: '6pt',
                        background: 'linear-gradient(90deg, rgba(102,126,234,0.35), rgba(118,75,162,0.35), rgba(240,147,251,0.35))', zIndex: '0'
                    });
                    clonedPreview.appendChild(topRibbon);
                    clonedPreview.appendChild(bottomRibbon);
                }
                
                if (coverPreview.classList.contains('template-3')) {
                    // Ensure template-3 footer accent appears in image
                    const footerAccent = document.createElement('div');
                    Object.assign(footerAccent.style, {
                        position: 'absolute', left: '22.5%', right: '22.5%', bottom: '1.6cm', height: '1.5pt', borderRadius: '2pt',
                        background: 'rgba(182, 142, 46, 0.4)'
                    });
                    clonedPreview.appendChild(footerAccent);
                }
                
                if (coverPreview.classList.contains('template-4')) {
                    // ensure green accent bar in footer appears in image
                    const footerAccent = document.createElement('div');
                    Object.assign(footerAccent.style, {
                        position: 'absolute', left: '25%', right: '25%', bottom: '1.6cm', height: '1.5pt', borderRadius: '2pt',
                        background: 'linear-gradient(90deg, rgba(46,125,50,0.35), rgba(76,175,80,0.35))'
                    });
                    clonedPreview.appendChild(footerAccent);
                }
                
                if (coverPreview.classList.contains('template-6')) {
                    // Recreate inner radial overlay that uses ::before in CSS
                    const innerOverlay = document.createElement('div');
                    Object.assign(innerOverlay.style, {
                        content: '""', position: 'absolute', top: '0.7cm', left: '0.7cm', right: '0.7cm', bottom: '0.7cm',
                        borderRadius: '12pt',
                        background: 'radial-gradient(circle at 20% 20%, rgba(66,165,245,0.08), transparent 60%),\
                                    radial-gradient(circle at 80% 80%, rgba(126,87,194,0.08), transparent 60%)',
                        pointerEvents: 'none', zIndex: '0'
                    });
                    clonedPreview.appendChild(innerOverlay);
                }
                
                if (coverPreview.classList.contains('template-7')) {
                    // Ensure template-7 footer accent appears in image
                    const footerAccent = document.createElement('div');
                    Object.assign(footerAccent.style, {
                        position: 'absolute', left: '22.5%', right: '22.5%', bottom: '1.6cm', height: '1.5pt', borderRadius: '2pt',
                        background: 'linear-gradient(90deg, rgba(66,66,66,0.4), rgba(97,97,97,0.4))'
                    });
                    clonedPreview.appendChild(footerAccent);
                }
                
                if (coverPreview.classList.contains('template-8')) {
                    // Ensure template-8 footer accent appears in image
                    const footerAccent = document.createElement('div');
                    Object.assign(footerAccent.style, {
                        position: 'absolute', left: '22.5%', right: '22.5%', bottom: '1.6cm', height: '1.5pt', borderRadius: '2pt',
                        background: 'linear-gradient(90deg, rgba(97,97,97,0.4), rgba(117,117,117,0.4))'
                    });
                    clonedPreview.appendChild(footerAccent);
                }
                
                if (coverPreview.classList.contains('template-9')) {
                    // Recreate inner radial overlay for template-9
                    const innerOverlay = document.createElement('div');
                    Object.assign(innerOverlay.style, {
                        content: '""', position: 'absolute', top: '0.8cm', left: '0.8cm', right: '0.8cm', bottom: '0.8cm',
                        borderRadius: '16pt',
                        background: 'radial-gradient(circle at 25% 25%, rgba(30,58,138,0.08), transparent 60%),\
                                    radial-gradient(circle at 75% 75%, rgba(59,130,246,0.08), transparent 60%)',
                        pointerEvents: 'none', zIndex: '0'
                    });
                    clonedPreview.appendChild(innerOverlay);
                    
                    // Ensure template-9 footer accent appears in image
                    const footerAccent = document.createElement('div');
                    Object.assign(footerAccent.style, {
                        position: 'absolute', left: '22.5%', right: '22.5%', bottom: '1.6cm', height: '1.5pt', borderRadius: '2pt',
                        background: 'linear-gradient(90deg, rgba(30,58,138,0.4), rgba(59,130,246,0.4))'
                    });
                    clonedPreview.appendChild(footerAccent);
                }
                
                // Đảm bảo logo hiển thị đúng trong ảnh
                const logoBox = clonedPreview.querySelector('#logoBox');
                if (logoBox) {
                    if (logoDataUrl) {
                        // Nếu có logo tùy chọn
                        logoBox.innerHTML = '<img id="previewLogo" alt="logo" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 50%; width: 100%; height: 100%;">';
                        const img = logoBox.querySelector('#previewLogo');
                        if (img) img.src = logoDataUrl;
                    } else {
                        // Nếu dùng logo mặc định
                        logoBox.innerHTML = '<img id="defaultLogo" src="logo-neu-inkythuatso-01-09-10-41-01 (1).jpg" alt="NEU Logo" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 50%; width: 100%; height: 100%;">';
                    }
                }
                
                // Thêm CSS để đảm bảo hiển thị đúng trong ảnh
                const style = document.createElement('style');
                style.textContent = `
                    * { box-sizing: border-box; }
                    body { margin: 0; padding: 0; }
                    .cover-preview { 
                        transform: none !important; 
                        width: 21cm !important; 
                        height: 29.7cm !important; 
                        margin: 0 !important; 
                        overflow: visible !important;
                    }
                    .cover-content { 
                        height: 100% !important; 
                        overflow: visible !important;
                    }
                    .footer-section { 
                        display: block !important; 
                        visibility: visible !important; 
                        opacity: 1 !important; 
                        position: relative !important; 
                        z-index: 10 !important; 
                        background: #fff !important;
                    }
                    .logo-placeholder img {
                        max-width: 100% !important;
                        max-height: 100% !important;
                        object-fit: contain !important;
                        border-radius: 50% !important;
                        width: 100% !important;
                        height: 100% !important;
                    }
                `;
                clonedPreview.appendChild(style);
                
                // Tạo element tạm thời để render HTML
                const tempDiv = document.createElement('div');
                tempDiv.appendChild(clonedPreview);
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.top = '0';
                document.body.appendChild(tempDiv);
                
                // Chuyển HTML thành canvas với cài đặt tối ưu
                const canvas = await html2canvas(clonedPreview, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    scrollX: 0,
                    scrollY: 0,
                    onclone: (doc) => {
                        // Ensure ornaments hidden per template rules are respected
                        const cloned = doc.getElementById('coverPreview');
                        if (!cloned) return;
                        const tpl = cloned.className;
                        const allOrn = cloned.querySelectorAll('.corner-ornament, .lotus-ornament, .wave-ornament');
                        allOrn.forEach(el => el.style.display = 'none');
                        if (tpl.includes('template-3')) {
                            cloned.querySelectorAll('.corner-ornament').forEach(el => el.style.display = 'block');
                        }
                        if (tpl.includes('template-4')) {
                            cloned.querySelectorAll('.lotus-ornament').forEach(el => el.style.display = 'block');
                        }
                        if (tpl.includes('template-6')) {
                            cloned.querySelectorAll('.wave-ornament').forEach(el => el.style.display = 'block');
                        }
                        if (tpl.includes('template-7')) {
                            cloned.querySelectorAll('.artistic-ornament').forEach(el => el.style.display = 'block');
                        }
                        if (tpl.includes('template-8')) {
                            cloned.querySelectorAll('.gradient-ornament').forEach(el => el.style.display = 'block');
                        }
                        if (tpl.includes('template-9')) {
                            cloned.querySelectorAll('.elegant-ornament').forEach(el => el.style.display = 'block');
                        }
                    }
                });
                
                // Hiện ảnh trong preview thay vì tải xuống
                const coverImage = document.getElementById('coverImage');
                if (coverImage) {
                    coverImage.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = canvas.toDataURL('image/png', 1.0);
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'contain';
                    img.style.cursor = 'pointer';
                    img.title = 'Click để copy ảnh';
                    
                    // Thêm click để copy
                    img.addEventListener('click', async () => {
                        try {
                            const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                            const clipboardItem = new ClipboardItem({ 'image/png': blob });
                            await navigator.clipboard.write([clipboardItem]);
                            alert('✅ Đã copy ảnh vào clipboard!\n\nBây giờ bạn có thể paste vào Google Docs (Ctrl+V)');
                        } catch (error) {
                            alert('❌ Không thể copy vào clipboard.\n\nVui lòng copy thủ công: Right-click → Copy image');
                        }
                    });
                    
                    coverImage.appendChild(img);
                }
                
                // Dọn dẹp
                document.body.removeChild(tempDiv);
                
                alert('✅ Đã tạo ảnh bìa thành công!\n\nClick vào ảnh bên phải để copy vào clipboard');
                
            } catch (error) {
                console.error('Lỗi tạo ảnh bìa:', error);
                alert('Có lỗi xảy ra khi tạo ảnh bìa. Vui lòng thử lại.');
            }
        }
    </script>
</body>
</html>

